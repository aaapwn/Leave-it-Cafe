{% extends 'app_cafe/components/template.html' %}

{% block content %}
        <h1>Caf√©</h1>
    <a href="{% url 'board' %}">Board</a>
    <a href="{% url 'home' %}">Home</a>
    <div style="overflow-y: scroll; background-color: grey; height:400px;">
        <div id="display"></div>
    </div>
<div style="color: aqua;"></div>
    <script>
        $(document).ready(function(){
        
        setInterval(function(){
            $.ajax({
                type: 'GET',
                url : "/cafe/getmessages",
                success: function(response){
                    console.log(response);
                    $("#display").empty();
                    for (var key in response.messages)
                    {
                        var temp="<div><p>"+response.messages[key].displayname+" : "+response.messages[key].text+"</p></div>";
                        $("#display").append(temp);
                    }
                },
                error: function(response){
                    alert('An error occured')
                }
            });
        },1000);
        })
    </script>

    <form id="post-form">
        {% csrf_token %}
        <input type="hidden" name="displayname" id="displayname" value="{{displayname}}">
        <input type="text" name="message" id="message">
        <input type="submit" value="SEND!!!">
    </form>

    <script>
        $(document).on('submit','#post-form',function(e){
            e.preventDefault();

            $.ajax({
                type:'POST',
                url:'/cafe/send',
                data:{
                    displayname:$('#displayname').val(),
                    message:$('#message').val(),
                csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val(),
                },
                success: function(data){
                    // alert(data)
                }
            });
            document.getElementById('message').value = ''
            });
    </script>
{% endblock %}
